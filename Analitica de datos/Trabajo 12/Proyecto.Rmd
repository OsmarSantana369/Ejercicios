---
title: "Proyecto"
author: "Osmar Dominique Santana Reyes"
date: "2025-10-02"
output: html_document
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(modeest)
datos <- read.csv("C:/Users/CONTROL/Desktop/Ejercicios/Analitica/Trabajo 12/PIB.csv")
pib <- datos[,c(1,34,35)]
```

En una base de datos que contiene el Producto Interno Bruto (PIB) de varios países desde el año 1986 al 2023, se realizará lo siguiente:

1.  **Cambiar los datos faltantes para una variable por la media y la otra variable por la mediana. Además, los datos atípicos se cambiarán por los máximo y mínimo de los alambres (bigotes).**

    ```{r, echo=FALSE, include=FALSE}
    sum(is.na(pib))
    mean(pib$X2018, na.rm = TRUE)
    median(pib$X2018, na.rm = TRUE)
    ```

    Hay 12 países que tienen datos faltantes, la media y mediana del año 2018 son 17601.66 y 6946.335, respectivamente, además de que el histograma de los datos con la media y mediana trazados es el siguiente:

    ```{r, echo=FALSE}
    hist(na.omit(pib$X2018), main = "PIB del año 2018", xlab = "PIB", ylab = "Frecuencia", ylim = c(0,200))
    abline(v = mean(pib$X2018, na.rm = TRUE), col = "blue", lwd = 2)
    abline(v = median(pib$X2018, na.rm = TRUE), col = "red", lwd = 2)
    ```

    De esta manera, al ser los datos asimétricos, se usará la mediana como reemplazo de los datos faltantes del 2018, mientras que los del año 2019 se reemplazarán con la media.

    ```{r, echo=FALSE}
    pib18 <- pib$X2018
    pib18[is.na(pib18)] <- 0
    pib18_0 <- pib18
    pib18 <- replace(pib18, pib18_0 == 0, median(pib18))

    pib19 <- pib$X2019
    pib19[is.na(pib19)] <- 0
    pib19_0 <- pib19
    pib19 <- replace(pib19, pib19_0 == 0, median(pib19))
    ```

    Ahora, los boxplot's para el año 2018 y 2019 son los siguientes:

    ```{r, echo=FALSE}
    boxplot(pib18, horizontal=TRUE, main="Boxplot con datos atípicos del año 2018")
    stripchart(pib18, method="jitter", pch=16, add=TRUE, col="magenta")

    boxplot(pib19, horizontal=TRUE, main="Boxplot con datos atípicos del año 2019")
    stripchart(pib19, method="jitter", pch=16, add=TRUE, col="magenta")
    ```

    Se llevarán los datos atípicos a los extremos de los alambres del boxplot en ambas variables (2018 y 2019).

    ```{r, echo=FALSE}
    extizq <- 2273.4 - 1.5*(20017.4 - 2273.4) 
    extder <- 20017.4 + 1.5*(20017.4 - 2273.4)
    datosNoAtipicos<-pib18[pib18>extizq & pib18<=extder]
    valor<-max(datosNoAtipicos) 
    pib18[pib18>extder]<-valor

    extizq <- 2224.2 - 1.5*(20369.7 - 2224.2) 
    extder <- 20369.7 + 1.5*(20369.7 - 2224.2)
    datosNoAtipicos<-pib19[pib19>extizq & pib19<=extder]
    valor<-max(datosNoAtipicos) 
    pib19[pib19>extder]<-valor
    ```

    Así, los boxplot quedan como sigue:

    ```{r, echo=FALSE}
    boxplot(pib18, horizontal=TRUE, main="Boxplot con datos atípicos del año 2018")
    stripchart(pib18, method="jitter", pch=16, add=TRUE, col="magenta")

    boxplot(pib19, horizontal=TRUE, main="Boxplot con datos atípicos del año 2019")
    stripchart(pib19, method="jitter", pch=16, add=TRUE, col="magenta")
    ```

2.  **Un análisis descriptivo de las dos variables.**

    Para el año 2018:

    ```{r, echo=FALSE}
    cat("La media del PIB es: ", mean(pib18))
    cat("La mediana del PIB es: ", median(pib18))
    cat("La moda del PIB es: ", mlv(pib18, method = "mfv"))
    cat("La varianza del PIB es: ", var(pib18))
    cat("La desviación estándar del PIB es: ", sd(pib18))

    cv <- function(x) sd(x)/mean(x)
    cat("El coeficiente de variación es:", cv(pib18)*100)

    cat("Los cuartiles son:", quantile(pib18, c(0.25,0.5,0.75)))
    ```

    Para el año 2019:

    ```{r, echo=FALSE}
    cat("La media del PIB es: ", mean(pib19))
    cat("La mediana del PIB es: ", median(pib19))
    cat("La moda del PIB es: ", mlv(pib19, method = "mfv"))
    cat("La varianza del PIB es: ", var(pib19))
    cat("La desviación estándar del PIB es: ", sd(pib19))

    cv <- function(x) sd(x)/mean(x)
    cat("El coeficiente de variación es:", cv(pib19)*100)

    cat("Los cuartiles son:", quantile(pib19, c(0.25,0.5,0.75)))
    ```

3.  **Colocar al menos dos gráficos por cada variable. Dar una pequeña interpretación.**

    Para el año 2018:

    ```{r, echo=FALSE}
    hist(pib18, main = "PIB del año 2018", xlab = "PIB", ylab = "Frecuencia")
    abline(v = mean(pib18), col = "blue", lwd = 2)
    abline(v = median(pib18), col = "red", lwd = 2)
    ```

    Por la gráfica se deduce que los datos son muy asimétricos y que la cantidad de países con bajo PIB es mayoritaria y decrece conforme crece el valor del PIB. Además de que los países con mayor PIB son una minoría, aún cuando se compara con los que tienen un PIB entre 20000 y 45000.

    Para el año 2019:

    ```{r, echo=FALSE}
    hist(pib19, main = "PIB del año 2019", xlab = "PIB", ylab = "Frecuencia")
    abline(v = mean(pib19), col = "blue", lwd = 2)
    abline(v = median(pib19), col = "red", lwd = 2)
    ```

    Esta gráfica es muy similar que la anterior, por lo que se puede asegurar lo mismo que se mencionó con anterioridad.

    Dada la semejanza entre ambas gráficas, se graficarán las diferencias entre los PIB de ambos años:

    ```{r, echo=FALSE}
    hist(pib19 - pib18, main = "PIB del año 2019", xlab = "PIB", ylab = "Frecuencia")
    abline(v = mean(pib19 - pib18), col = "blue", lwd = 2)
    abline(v = median(pib19 - pib18), col = "red", lwd = 2)
    ```

    Se puede observar que son muy pocos los casos en los que el PIB varió de un año a otro, además de que tanto la media como la mediana están cerca del 0, por lo que se puede decir que la variación del PIB entre ambos años es muy pequeña. A pesar de esto, es interesante notar que la mayoría de los países pudo incrementar en cierta cantidad su PIB, aunque la mayoría no tuvo un gran incremento, mientras que son muy pocos los que lograron incrementarlo en una gran cantidad.

4.  **Realizar una regresión lineal simple de los dos años. Predecir el PIB del año posterior a partir del año anterior. Encontrar el modelo, y decir si es bueno para realizar predicciones (mostrar dos predicciones para dos valores de PIB).**

    ```{r, echo=FALSE}
    cat("La correlación entre ambos años es", cor(pib18, pib19), ", que es muy cercano a 1, así se puede decir que ambas variables tienen una muy buena relación lineal.")

    pib <- data.frame(X2018 = pib18, X2019 = pib19)
    modelo <- lm(X2019 ~ X2018, data = pib)
    summary(modelo)
    ```

    El coeficiente de la variable de respuesta es significativo para el modelo, pero el intercepto no lo es. Dado que las diferencias entre los PIB en ambos años es en promedio cero, el valor del intercepto se hará 0 (si cierto país tuvo un PIB de 0, lo más seguro es que no se haya incrementado demasiado para el siguiente año).

    ```{r, echo=FALSE}
    anova(modelo)
    ```

    Luego, el coeficiente de determinación del modelo es 0.999, por lo que el ajuste lineal es muy bueno. Además, del ANOVA del modelo se obtiene un p-value de $2.2*10^{-16}$, por lo que el modelo es significativo.

    ```{r, echo=FALSE, message=FALSE, warning=FALSE}
    library(car)
    ncvTest(modelo)
    ```

    Posteriormente, de la prueba de homocedasticidad, se obtiene un p-value de $2.22 \cdot 10^{-16}$ por lo que se rechaza la hipótesis nula de que la varianza es constante.

    ```{r, echo=FALSE}
    residuos <- rstandard(modelo)  
    shapiro.test(residuals(modelo))
    ```

    Por otro lado, de la prueba de normalidad se obtiene un p-value de $2.2 \cdot 10^{-16}$ por lo que se rechaza la hipótesis nula de que los errores están distribuidos de manera normal.

    De este modo, la ecuación del modelo es $$ PIB19 = 0 + 1.001045 \cdot PIB18 $$ y la gráfica correspondiente es:

    ```{r, echo=FALSE, warning=FALSE, message=FALSE}
    library(ggplot2)

    ggplot(pib, aes(x = X2018, y = X2019)) +
      geom_point()+
      geom_smooth(method = "lm", se = FALSE)+
      labs(title = "PIB de países en el año 2018 contra el año 2019", x = "2018", y = "2019")+
      theme_linedraw()
    ```

    Aunque los supuestos de homocedasticidad y normalidad no se cumplen, el modelo parece ser lo suficientemente bueno para predecir el PIB del año 2019 a partir del de 2018.

    Por último, utilizando el modelo para predecir el valor del PIB en el año 2019 cuando en el 2018 se tuvo de 10000 y 40000:

    ```{r, echo=FALSE}
    nuevo <- data.frame(X2018 = c(10000, 40000))
    predict(object=modelo, newdata=nuevo, interval="confidence", level = 0.95)
    predict(object=modelo, newdata=nuevo, interval="prediction", level = 0.95)
    ```
